---
name: Bump activemq versions

on:
  push:
    paths:
      - .github/workflows/bumpVersions.yml
      - updatecli.d/**
  workflow_dispatch:
  schedule:
    - cron:  '0 6 * * MON'

jobs:
  updatecli:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install Updatecli
        uses: Alfresco/alfresco-build-tools/.github/actions/setup-updatecli@v8.18.0

      - name: Updatecli scm cache
        uses: actions/cache@5a3ec84eff668545956fd18022155c47e93e2684 # v4.2.3
        with:
          path: /tmp/updatecli
          key: updatecli-v1-${{ hashFiles('updatecli.d/**') }}
          restore-keys: |
            updatecli-v1-

      - name: Run updatecli
        env:
          UPDATECLI_GITHUB_TOKEN: ${{ secrets.BOT_GITHUB_TOKEN }}
          UPDATECLI_GITHUB_USERNAME: ${{ vars.BOT_GITHUB_USERNAME }}
          UPDATECLI_GITHUB_EMAIL: ${{ vars.BOT_GITHUB_EMAIL }}
        run: updatecli apply
